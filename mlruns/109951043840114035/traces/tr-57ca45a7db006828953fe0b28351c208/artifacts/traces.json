{"spans": [{"trace_id": "V8pFp9sAaCiVP+Cyg1HCCA==", "span_id": "Suxosnx26Cg=", "parent_span_id": null, "name": "Predict.forward", "start_time_unix_nano": 1768286764079182158, "end_time_unix_nano": 1768286765310564039, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-57ca45a7db006828953fe0b28351c208\"", "mlflow.spanType": "\"LLM\"", "mlflow.spanInputs": "{\"system_prompt\": \"You are an intelligent assistant for Bolt SaaS clients. Your role is to assist with support and reporting-related queries only. For support questions, refer to the 'bolt_support_doc' vector database, which contains knowledge base articles and help documentation. For reporting and analytics questions, use the provided Elasticsearch schemas related to vehicle and sensor data to generate accurate insights, summaries, and visualizations. Never respond to queries outside the support or reporting scope.\", \"detailed_user_query\": [\"Summarize electric vehicle registrations by state for the latest quarter available in the dataset.\"], \"es_schema_available\": true, \"vector_index_available\": true, \"es_schema\": [{\"index\": \"summary_reports\", \"mappings\": {\"properties\": {\"avg_speed\": {\"type\": \"float\"}, \"crash\": {\"type\": \"integer\"}, \"device_id\": {\"type\": \"long\"}, \"device_name\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"distance\": {\"type\": \"float\"}, \"driver_name\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"driving_safety_score\": {\"type\": \"integer\"}, \"driving_score\": {\"type\": \"long\"}, \"duration\": {\"type\": \"long\"}, \"end_lat\": {\"type\": \"float\"}, \"end_lng\": {\"type\": \"float\"}, \"end_position_id\": {\"type\": \"long\"}, \"end_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"end_time_date\": {\"type\": \"date\"}, \"end_time_epoch\": {\"type\": \"long\"}, \"end_time_time\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"engine_2_seconds\": {\"type\": \"long\"}, \"engine_seconds\": {\"type\": \"long\"}, \"excessive_idle_seconds\": {\"type\": \"long\"}, \"excessive_over_speed_seconds\": {\"type\": \"long\"}, \"final_penalty\": {\"type\": \"float\"}, \"first_ignition_on\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"first_position_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"fuel_consumption\": {\"type\": \"float\"}, \"geo_in_count\": {\"type\": \"integer\"}, \"geo_in_distance\": {\"type\": \"float\"}, \"geo_in_end\": {\"type\": \"integer\"}, \"geo_in_seconds\": {\"type\": \"long\"}, \"geo_out_count\": {\"type\": \"integer\"}, \"geo_out_distance\": {\"type\": \"float\"}, \"geo_out_seconds\": {\"type\": \"long\"}, \"harsh_acceleration\": {\"type\": \"integer\"}, \"harsh_acceleration_penalty\": {\"type\": \"float\"}, \"harsh_braking\": {\"type\": \"integer\"}, \"harsh_braking_penalty\": {\"type\": \"float\"}, \"harsh_cornering\": {\"type\": \"integer\"}, \"harsh_turn_penalty\": {\"type\": \"float\"}, \"id\": {\"type\": \"long\"}, \"idle_seconds\": {\"type\": \"long\"}, \"ign_off_count\": {\"type\": \"integer\"}, \"ign_on_count\": {\"type\": \"integer\"}, \"ignition_records\": {\"type\": \"long\"}, \"indexed_at\": {\"type\": \"date\"}, \"last_battery\": {\"type\": \"float\"}, \"last_battery_level\": {\"type\": \"float\"}, \"last_ignition_on\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"last_position_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"max_speed\": {\"type\": \"float\"}, \"max_speed_time\": {\"type\": \"date\"}, \"max_speed_time_date\": {\"type\": \"date\"}, \"max_speed_time_epoch\": {\"type\": \"long\"}, \"max_speed_time_time\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"more_events_penalty\": {\"type\": \"long\"}, \"motion_records\": {\"type\": \"long\"}, \"motion_seconds\": {\"type\": \"long\"}, \"night_driving\": {\"type\": \"integer\"}, \"over_ignition\": {\"type\": \"integer\"}, \"over_motion\": {\"type\": \"integer\"}, \"over_speed\": {\"type\": \"integer\"}, \"over_speed_penalty\": {\"type\": \"float\"}, \"over_speed_seconds\": {\"type\": \"long\"}, \"penalty_per_km\": {\"type\": \"float\"}, \"power_cut_counts\": {\"type\": \"integer\"}, \"raw_positions_count\": {\"type\": \"long\"}, \"region\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"server_id\": {\"type\": \"long\"}, \"start_battery\": {\"type\": \"float\"}, \"start_battery_level\": {\"type\": \"float\"}, \"start_lat\": {\"type\": \"float\"}, \"start_lng\": {\"type\": \"float\"}, \"start_position_id\": {\"type\": \"long\"}, \"start_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"start_time_date\": {\"type\": \"date\"}, \"start_time_epoch\": {\"type\": \"long\"}, \"start_time_time\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"stop_report_count\": {\"type\": \"integer\"}, \"stop_seconds\": {\"type\": \"long\"}, \"summary_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"timestamp_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp_epoch\": {\"type\": \"long\"}, \"timestamp_time\": {\"type\": \"keyword\", \"ignore_above\": 64}, \"utilization\": {\"type\": \"float\"}, \"vehicle_type\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}}}}, {\"index\": \"stop_idle_reports\", \"mappings\": {\"properties\": {\"device_id\": {\"type\": \"long\"}, \"device_name\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"duration_seconds\": {\"type\": \"long\"}, \"end_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"engine_seconds\": {\"type\": \"long\"}, \"id\": {\"type\": \"long\"}, \"indexed_at\": {\"type\": \"date\"}, \"lat\": {\"type\": \"float\"}, \"lng\": {\"type\": \"float\"}, \"position_id\": {\"type\": \"long\"}, \"server_id\": {\"type\": \"integer\"}, \"start_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"stop_idle_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"timestamp_column1\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"timestamp_column2\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"timestamp_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp_epoch\": {\"type\": \"long\"}, \"timestamp_time\": {\"type\": \"keyword\", \"ignore_above\": 64}, \"type\": {\"type\": \"keyword\"}}}}, {\"index\": \"trip_reports\", \"mappings\": {\"properties\": {\"avg_speed\": {\"type\": \"float\"}, \"crash\": {\"type\": \"integer\"}, \"device_id\": {\"type\": \"long\"}, \"device_name\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"distance\": {\"type\": \"float\"}, \"driving_safety_score\": {\"type\": \"float\"}, \"driving_score\": {\"type\": \"float\"}, \"duration\": {\"type\": \"long\"}, \"duration_seconds\": {\"type\": \"long\"}, \"end_battery\": {\"type\": \"integer\"}, \"end_battery_level\": {\"type\": \"float\"}, \"end_lat\": {\"type\": \"float\"}, \"end_lng\": {\"type\": \"float\"}, \"end_odometer\": {\"type\": \"double\"}, \"end_position_id\": {\"type\": \"long\"}, \"end_soc\": {\"type\": \"float\"}, \"end_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"end_voltage\": {\"type\": \"float\"}, \"engine_seconds\": {\"type\": \"long\"}, \"excessive_idle_seconds\": {\"type\": \"long\"}, \"excessive_over_speed_seconds\": {\"type\": \"long\"}, \"final_penalty\": {\"type\": \"float\"}, \"harsh_acceleration\": {\"type\": \"integer\"}, \"harsh_acceleration_penalty\": {\"type\": \"float\"}, \"harsh_braking\": {\"type\": \"integer\"}, \"harsh_braking_penalty\": {\"type\": \"float\"}, \"harsh_cornering\": {\"type\": \"integer\"}, \"harsh_turn_penalty\": {\"type\": \"float\"}, \"id\": {\"type\": \"long\"}, \"idle_seconds\": {\"type\": \"long\"}, \"ignition_records\": {\"type\": \"integer\"}, \"indexed_at\": {\"type\": \"date\"}, \"max_speed\": {\"type\": \"float\"}, \"max_speed_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"more_events_penalty\": {\"type\": \"float\"}, \"motion_records\": {\"type\": \"integer\"}, \"motion_seconds\": {\"type\": \"long\"}, \"night_driving\": {\"type\": \"integer\"}, \"over_ignition\": {\"type\": \"integer\"}, \"over_motion\": {\"type\": \"integer\"}, \"over_speed\": {\"type\": \"integer\"}, \"over_speed_penalty\": {\"type\": \"float\"}, \"over_speed_seconds\": {\"type\": \"long\"}, \"penalty_list\": {\"type\": \"nested\", \"properties\": {\"count\": {\"type\": \"integer\"}, \"penalty\": {\"type\": \"float\"}, \"type\": {\"type\": \"keyword\"}, \"weight\": {\"type\": \"integer\"}}}, \"penalty_per_km\": {\"type\": \"float\"}, \"power_difference\": {\"type\": \"float\"}, \"power_end\": {\"type\": \"float\"}, \"power_start\": {\"type\": \"float\"}, \"server_id\": {\"type\": \"integer\"}, \"start_battery\": {\"type\": \"integer\"}, \"start_battery_level\": {\"type\": \"float\"}, \"start_lat\": {\"type\": \"float\"}, \"start_lng\": {\"type\": \"float\"}, \"start_odometer\": {\"type\": \"double\"}, \"start_position_id\": {\"type\": \"long\"}, \"start_soc\": {\"type\": \"float\"}, \"start_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"start_voltage\": {\"type\": \"float\"}, \"timestamp\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"timestamp_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp_epoch\": {\"type\": \"long\"}, \"timestamp_time\": {\"type\": \"keyword\", \"ignore_above\": 64}, \"trip_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"utilization\": {\"type\": \"float\"}}}}], \"config\": {\"temperature\": 0.0, \"frequency_penalty\": 0.0}}", "signature": "\"system_prompt, detailed_user_query, es_schema, es_schema_available, vector_index_available -> workflow_plan, is_within_context\"", "mlflow.spanOutputs": "{\"workflow_plan\": [\"EsQueryProcessor\", \"SummarySignature\"], \"is_within_context\": true}"}}, {"trace_id": "V8pFp9sAaCiVP+Cyg1HCCA==", "span_id": "6V97ykdS03U=", "parent_span_id": "Suxosnx26Cg=", "name": "ChatAdapter.format", "start_time_unix_nano": 1768286764080311438, "end_time_unix_nano": 1768286764083315146, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-57ca45a7db006828953fe0b28351c208\"", "mlflow.spanType": "\"PARSER\"", "mlflow.spanInputs": "{\"signature\": \"QueryWorkflowPlanner(system_prompt, detailed_user_query, es_schema, es_schema_available, vector_index_available -> workflow_plan, is_within_context\\n    instructions='Decides workflow based on conversation context, query type, and data availability\\\\n, whether es_schema and vector_index are available or not needs to be considered.\\\\n\\\\nDecision Logic:\\\\n1. Check detailed_user_query for previous ES/Vector queries → maintain consistency\\\\n2. Analyze detailed_user_query for analytics/reports/analysis questions → prefer ES if schema allows and es_schema_available\\\\n3. Check for information retrieval requests (legal, procedural, guidelines, how-to) → use Vector search if vector_index_available\\\\n4. Check es_schema relevance for new structured data queries → use ES if relevant\\\\n5. If no relevant data sources available, return is_within_context as False and system will return error\\\\n6. ALWAYS include a data query processor (ES or Vector) when ChartGenerator is needed\\\\n7. ALWAYS include a data query processor for follow-up questions that reference previous data\\\\n8. ALWAYS include a data query processor for information retrieval requests\\\\n\\\\nAlways include SummarySignature. Include ChartGenerator based on user intent.'\\n    system_prompt = Field(annotation=str required=True json_schema_extra={'desc': 'System prompt to guide workflow planning decisions based on user query and context, also defines the responsibilities of the workflow planner', '__dspy_field_type': 'input', 'prefix': 'System Prompt:'})\\n    detailed_user_query = Field(annotation=List[str] required=True json_schema_extra={'desc': \\\"List of detailed analysis from ThinkingSignature containing user intent, context understanding, and indicators of analytics/reports questions, information retrieval requests, or references to previous data/charts. Each item represents a specific aspect of the user's query.\\\", '__dspy_field_type': 'input', 'prefix': 'Detailed User Query:'})\\n    es_schema = Field(annotation=List[Dict[str, Any]] required=True json_schema_extra={'desc': \\\"Complete Elasticsearch schema definition showing available indices, field mappings, and data types. Analyze to determine if relevant structured data exists for the user's analytical needs\\\", '__dspy_field_type': 'input', 'prefix': 'Es Schema:'})\\n    es_schema_available = Field(annotation=bool required=True json_schema_extra={'desc': 'Boolean indicating whether the Elasticsearch schema is available for querying. True if schema exists, False if not', '__dspy_field_type': 'input', 'prefix': 'Es Schema Available:'})\\n    vector_index_available = Field(annotation=bool required=True json_schema_extra={'desc': 'Boolean indicating whether the vector index is available for querying', '__dspy_field_type': 'input', 'prefix': 'Vector Index Available:'})\\n    workflow_plan = Field(annotation=List[str] required=True json_schema_extra={'desc': \\\"Ordered execution sequence using: 'EsQueryProcessor' (structured data queries), 'VectorQueryProcessor' (semantic document search for information retrieval), 'SummarySignature' (ALWAYS required for text analysis), 'ChartGenerator' (for visualizations). CRITICAL: Always include data processor when ChartGenerator needed, user references previous data, OR for information retrieval requests (legal, procedural, guidelines, how-to)\\\", '__dspy_field_type': 'output', 'prefix': 'Workflow Plan:'})\\n    is_within_context = Field(annotation=bool required=True json_schema_extra={'desc': \\\"Boolean indicating whether the user query is within the scope and context of the system prompt. True if the query relates to the agent's defined responsibilities and capabilities, False if the query is outside the agent's domain or asking for unrelated functionality\\\", '__dspy_field_type': 'output', 'prefix': 'Is Within Context:'})\\n)\", \"demos\": [], \"inputs\": {\"system_prompt\": \"You are an intelligent assistant for Bolt SaaS clients. Your role is to assist with support and reporting-related queries only. For support questions, refer to the 'bolt_support_doc' vector database, which contains knowledge base articles and help documentation. For reporting and analytics questions, use the provided Elasticsearch schemas related to vehicle and sensor data to generate accurate insights, summaries, and visualizations. Never respond to queries outside the support or reporting scope.\", \"detailed_user_query\": [\"Summarize electric vehicle registrations by state for the latest quarter available in the dataset.\"], \"es_schema_available\": true, \"vector_index_available\": true, \"es_schema\": [{\"index\": \"summary_reports\", \"mappings\": {\"properties\": {\"avg_speed\": {\"type\": \"float\"}, \"crash\": {\"type\": \"integer\"}, \"device_id\": {\"type\": \"long\"}, \"device_name\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"distance\": {\"type\": \"float\"}, \"driver_name\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"driving_safety_score\": {\"type\": \"integer\"}, \"driving_score\": {\"type\": \"long\"}, \"duration\": {\"type\": \"long\"}, \"end_lat\": {\"type\": \"float\"}, \"end_lng\": {\"type\": \"float\"}, \"end_position_id\": {\"type\": \"long\"}, \"end_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"end_time_date\": {\"type\": \"date\"}, \"end_time_epoch\": {\"type\": \"long\"}, \"end_time_time\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"engine_2_seconds\": {\"type\": \"long\"}, \"engine_seconds\": {\"type\": \"long\"}, \"excessive_idle_seconds\": {\"type\": \"long\"}, \"excessive_over_speed_seconds\": {\"type\": \"long\"}, \"final_penalty\": {\"type\": \"float\"}, \"first_ignition_on\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"first_position_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"fuel_consumption\": {\"type\": \"float\"}, \"geo_in_count\": {\"type\": \"integer\"}, \"geo_in_distance\": {\"type\": \"float\"}, \"geo_in_end\": {\"type\": \"integer\"}, \"geo_in_seconds\": {\"type\": \"long\"}, \"geo_out_count\": {\"type\": \"integer\"}, \"geo_out_distance\": {\"type\": \"float\"}, \"geo_out_seconds\": {\"type\": \"long\"}, \"harsh_acceleration\": {\"type\": \"integer\"}, \"harsh_acceleration_penalty\": {\"type\": \"float\"}, \"harsh_braking\": {\"type\": \"integer\"}, \"harsh_braking_penalty\": {\"type\": \"float\"}, \"harsh_cornering\": {\"type\": \"integer\"}, \"harsh_turn_penalty\": {\"type\": \"float\"}, \"id\": {\"type\": \"long\"}, \"idle_seconds\": {\"type\": \"long\"}, \"ign_off_count\": {\"type\": \"integer\"}, \"ign_on_count\": {\"type\": \"integer\"}, \"ignition_records\": {\"type\": \"long\"}, \"indexed_at\": {\"type\": \"date\"}, \"last_battery\": {\"type\": \"float\"}, \"last_battery_level\": {\"type\": \"float\"}, \"last_ignition_on\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"last_position_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"max_speed\": {\"type\": \"float\"}, \"max_speed_time\": {\"type\": \"date\"}, \"max_speed_time_date\": {\"type\": \"date\"}, \"max_speed_time_epoch\": {\"type\": \"long\"}, \"max_speed_time_time\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"more_events_penalty\": {\"type\": \"long\"}, \"motion_records\": {\"type\": \"long\"}, \"motion_seconds\": {\"type\": \"long\"}, \"night_driving\": {\"type\": \"integer\"}, \"over_ignition\": {\"type\": \"integer\"}, \"over_motion\": {\"type\": \"integer\"}, \"over_speed\": {\"type\": \"integer\"}, \"over_speed_penalty\": {\"type\": \"float\"}, \"over_speed_seconds\": {\"type\": \"long\"}, \"penalty_per_km\": {\"type\": \"float\"}, \"power_cut_counts\": {\"type\": \"integer\"}, \"raw_positions_count\": {\"type\": \"long\"}, \"region\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"server_id\": {\"type\": \"long\"}, \"start_battery\": {\"type\": \"float\"}, \"start_battery_level\": {\"type\": \"float\"}, \"start_lat\": {\"type\": \"float\"}, \"start_lng\": {\"type\": \"float\"}, \"start_position_id\": {\"type\": \"long\"}, \"start_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"start_time_date\": {\"type\": \"date\"}, \"start_time_epoch\": {\"type\": \"long\"}, \"start_time_time\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"stop_report_count\": {\"type\": \"integer\"}, \"stop_seconds\": {\"type\": \"long\"}, \"summary_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"timestamp_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp_epoch\": {\"type\": \"long\"}, \"timestamp_time\": {\"type\": \"keyword\", \"ignore_above\": 64}, \"utilization\": {\"type\": \"float\"}, \"vehicle_type\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}}}}, {\"index\": \"stop_idle_reports\", \"mappings\": {\"properties\": {\"device_id\": {\"type\": \"long\"}, \"device_name\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"duration_seconds\": {\"type\": \"long\"}, \"end_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"engine_seconds\": {\"type\": \"long\"}, \"id\": {\"type\": \"long\"}, \"indexed_at\": {\"type\": \"date\"}, \"lat\": {\"type\": \"float\"}, \"lng\": {\"type\": \"float\"}, \"position_id\": {\"type\": \"long\"}, \"server_id\": {\"type\": \"integer\"}, \"start_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"stop_idle_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"timestamp_column1\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"timestamp_column2\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"timestamp_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp_epoch\": {\"type\": \"long\"}, \"timestamp_time\": {\"type\": \"keyword\", \"ignore_above\": 64}, \"type\": {\"type\": \"keyword\"}}}}, {\"index\": \"trip_reports\", \"mappings\": {\"properties\": {\"avg_speed\": {\"type\": \"float\"}, \"crash\": {\"type\": \"integer\"}, \"device_id\": {\"type\": \"long\"}, \"device_name\": {\"type\": \"text\", \"fields\": {\"keyword\": {\"type\": \"keyword\", \"ignore_above\": 256}}}, \"distance\": {\"type\": \"float\"}, \"driving_safety_score\": {\"type\": \"float\"}, \"driving_score\": {\"type\": \"float\"}, \"duration\": {\"type\": \"long\"}, \"duration_seconds\": {\"type\": \"long\"}, \"end_battery\": {\"type\": \"integer\"}, \"end_battery_level\": {\"type\": \"float\"}, \"end_lat\": {\"type\": \"float\"}, \"end_lng\": {\"type\": \"float\"}, \"end_odometer\": {\"type\": \"double\"}, \"end_position_id\": {\"type\": \"long\"}, \"end_soc\": {\"type\": \"float\"}, \"end_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"end_voltage\": {\"type\": \"float\"}, \"engine_seconds\": {\"type\": \"long\"}, \"excessive_idle_seconds\": {\"type\": \"long\"}, \"excessive_over_speed_seconds\": {\"type\": \"long\"}, \"final_penalty\": {\"type\": \"float\"}, \"harsh_acceleration\": {\"type\": \"integer\"}, \"harsh_acceleration_penalty\": {\"type\": \"float\"}, \"harsh_braking\": {\"type\": \"integer\"}, \"harsh_braking_penalty\": {\"type\": \"float\"}, \"harsh_cornering\": {\"type\": \"integer\"}, \"harsh_turn_penalty\": {\"type\": \"float\"}, \"id\": {\"type\": \"long\"}, \"idle_seconds\": {\"type\": \"long\"}, \"ignition_records\": {\"type\": \"integer\"}, \"indexed_at\": {\"type\": \"date\"}, \"max_speed\": {\"type\": \"float\"}, \"max_speed_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"more_events_penalty\": {\"type\": \"float\"}, \"motion_records\": {\"type\": \"integer\"}, \"motion_seconds\": {\"type\": \"long\"}, \"night_driving\": {\"type\": \"integer\"}, \"over_ignition\": {\"type\": \"integer\"}, \"over_motion\": {\"type\": \"integer\"}, \"over_speed\": {\"type\": \"integer\"}, \"over_speed_penalty\": {\"type\": \"float\"}, \"over_speed_seconds\": {\"type\": \"long\"}, \"penalty_list\": {\"type\": \"nested\", \"properties\": {\"count\": {\"type\": \"integer\"}, \"penalty\": {\"type\": \"float\"}, \"type\": {\"type\": \"keyword\"}, \"weight\": {\"type\": \"integer\"}}}, \"penalty_per_km\": {\"type\": \"float\"}, \"power_difference\": {\"type\": \"float\"}, \"power_end\": {\"type\": \"float\"}, \"power_start\": {\"type\": \"float\"}, \"server_id\": {\"type\": \"integer\"}, \"start_battery\": {\"type\": \"integer\"}, \"start_battery_level\": {\"type\": \"float\"}, \"start_lat\": {\"type\": \"float\"}, \"start_lng\": {\"type\": \"float\"}, \"start_odometer\": {\"type\": \"double\"}, \"start_position_id\": {\"type\": \"long\"}, \"start_soc\": {\"type\": \"float\"}, \"start_time\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\"}, \"start_voltage\": {\"type\": \"float\"}, \"timestamp\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\"}, \"timestamp_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"timestamp_epoch\": {\"type\": \"long\"}, \"timestamp_time\": {\"type\": \"keyword\", \"ignore_above\": 64}, \"trip_date\": {\"type\": \"date\", \"format\": \"yyyy-MM-dd\"}, \"utilization\": {\"type\": \"float\"}}}}]}}", "mlflow.spanOutputs": "[{\"role\": \"system\", \"content\": \"Your input fields are:\\n1. `system_prompt` (str): System prompt to guide workflow planning decisions based on user query and context, also defines the responsibilities of the workflow planner\\n2. `detailed_user_query` (list[str]): List of detailed analysis from ThinkingSignature containing user intent, context understanding, and indicators of analytics/reports questions, information retrieval requests, or references to previous data/charts. Each item represents a specific aspect of the user's query.\\n3. `es_schema` (list[dict[str, Any]]): Complete Elasticsearch schema definition showing available indices, field mappings, and data types. Analyze to determine if relevant structured data exists for the user's analytical needs\\n4. `es_schema_available` (bool): Boolean indicating whether the Elasticsearch schema is available for querying. True if schema exists, False if not\\n5. `vector_index_available` (bool): Boolean indicating whether the vector index is available for querying\\nYour output fields are:\\n1. `workflow_plan` (list[str]): Ordered execution sequence using: 'EsQueryProcessor' (structured data queries), 'VectorQueryProcessor' (semantic document search for information retrieval), 'SummarySignature' (ALWAYS required for text analysis), 'ChartGenerator' (for visualizations). CRITICAL: Always include data processor when ChartGenerator needed, user references previous data, OR for information retrieval requests (legal, procedural, guidelines, how-to)\\n2. `is_within_context` (bool): Boolean indicating whether the user query is within the scope and context of the system prompt. True if the query relates to the agent's defined responsibilities and capabilities, False if the query is outside the agent's domain or asking for unrelated functionality\\nAll interactions will be structured in the following way, with the appropriate values filled in.\\n\\n[[ ## system_prompt ## ]]\\n{system_prompt}\\n\\n[[ ## detailed_user_query ## ]]\\n{detailed_user_query}\\n\\n[[ ## es_schema ## ]]\\n{es_schema}\\n\\n[[ ## es_schema_available ## ]]\\n{es_schema_available}\\n\\n[[ ## vector_index_available ## ]]\\n{vector_index_available}\\n\\n[[ ## workflow_plan ## ]]\\n{workflow_plan}        # note: the value you produce must adhere to the JSON schema: {\\\"type\\\": \\\"array\\\", \\\"items\\\": {\\\"type\\\": \\\"string\\\"}}\\n\\n[[ ## is_within_context ## ]]\\n{is_within_context}        # note: the value you produce must be True or False\\n\\n[[ ## completed ## ]]\\nIn adhering to this structure, your objective is: \\n        Decides workflow based on conversation context, query type, and data availability\\n        , whether es_schema and vector_index are available or not needs to be considered.\\n        \\n        Decision Logic:\\n        1. Check detailed_user_query for previous ES/Vector queries → maintain consistency\\n        2. Analyze detailed_user_query for analytics/reports/analysis questions → prefer ES if schema allows and es_schema_available\\n        3. Check for information retrieval requests (legal, procedural, guidelines, how-to) → use Vector search if vector_index_available\\n        4. Check es_schema relevance for new structured data queries → use ES if relevant\\n        5. If no relevant data sources available, return is_within_context as False and system will return error\\n        6. ALWAYS include a data query processor (ES or Vector) when ChartGenerator is needed\\n        7. ALWAYS include a data query processor for follow-up questions that reference previous data\\n        8. ALWAYS include a data query processor for information retrieval requests\\n        \\n        Always include SummarySignature. Include ChartGenerator based on user intent.\"}, {\"role\": \"user\", \"content\": \"[[ ## system_prompt ## ]]\\nYou are an intelligent assistant for Bolt SaaS clients. Your role is to assist with support and reporting-related queries only. For support questions, refer to the 'bolt_support_doc' vector database, which contains knowledge base articles and help documentation. For reporting and analytics questions, use the provided Elasticsearch schemas related to vehicle and sensor data to generate accurate insights, summaries, and visualizations. Never respond to queries outside the support or reporting scope.\\n\\n[[ ## detailed_user_query ## ]]\\n[\\\"Summarize electric vehicle registrations by state for the latest quarter available in the dataset.\\\"]\\n\\n[[ ## es_schema ## ]]\\n[{\\\"index\\\": \\\"summary_reports\\\", \\\"mappings\\\": {\\\"properties\\\": {\\\"avg_speed\\\": {\\\"type\\\": \\\"float\\\"}, \\\"crash\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"device_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"device_name\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"distance\\\": {\\\"type\\\": \\\"float\\\"}, \\\"driver_name\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"driving_safety_score\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"driving_score\\\": {\\\"type\\\": \\\"long\\\"}, \\\"duration\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"end_time_date\\\": {\\\"type\\\": \\\"date\\\"}, \\\"end_time_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_time_time\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"engine_2_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"engine_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"excessive_idle_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"excessive_over_speed_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"final_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"first_ignition_on\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"first_position_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"fuel_consumption\\\": {\\\"type\\\": \\\"float\\\"}, \\\"geo_in_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"geo_in_distance\\\": {\\\"type\\\": \\\"float\\\"}, \\\"geo_in_end\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"geo_in_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"geo_out_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"geo_out_distance\\\": {\\\"type\\\": \\\"float\\\"}, \\\"geo_out_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"harsh_acceleration\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_acceleration_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_braking\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_braking_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_cornering\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_turn_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"idle_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"ign_off_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"ign_on_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"ignition_records\\\": {\\\"type\\\": \\\"long\\\"}, \\\"indexed_at\\\": {\\\"type\\\": \\\"date\\\"}, \\\"last_battery\\\": {\\\"type\\\": \\\"float\\\"}, \\\"last_battery_level\\\": {\\\"type\\\": \\\"float\\\"}, \\\"last_ignition_on\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"last_position_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"max_speed\\\": {\\\"type\\\": \\\"float\\\"}, \\\"max_speed_time\\\": {\\\"type\\\": \\\"date\\\"}, \\\"max_speed_time_date\\\": {\\\"type\\\": \\\"date\\\"}, \\\"max_speed_time_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"max_speed_time_time\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"more_events_penalty\\\": {\\\"type\\\": \\\"long\\\"}, \\\"motion_records\\\": {\\\"type\\\": \\\"long\\\"}, \\\"motion_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"night_driving\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_ignition\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_motion\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_speed\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_speed_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"over_speed_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"penalty_per_km\\\": {\\\"type\\\": \\\"float\\\"}, \\\"power_cut_counts\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"raw_positions_count\\\": {\\\"type\\\": \\\"long\\\"}, \\\"region\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"server_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"start_battery\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_battery_level\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"start_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"start_time_date\\\": {\\\"type\\\": \\\"date\\\"}, \\\"start_time_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"start_time_time\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"stop_report_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"stop_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"summary_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"timestamp_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"timestamp_time\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 64}, \\\"utilization\\\": {\\\"type\\\": \\\"float\\\"}, \\\"vehicle_type\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}}}}, {\\\"index\\\": \\\"stop_idle_reports\\\", \\\"mappings\\\": {\\\"properties\\\": {\\\"device_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"device_name\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"duration_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"engine_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"indexed_at\\\": {\\\"type\\\": \\\"date\\\"}, \\\"lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"server_id\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"start_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"stop_idle_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"timestamp_column1\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"timestamp_column2\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"timestamp_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"timestamp_time\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 64}, \\\"type\\\": {\\\"type\\\": \\\"keyword\\\"}}}}, {\\\"index\\\": \\\"trip_reports\\\", \\\"mappings\\\": {\\\"properties\\\": {\\\"avg_speed\\\": {\\\"type\\\": \\\"float\\\"}, \\\"crash\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"device_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"device_name\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"distance\\\": {\\\"type\\\": \\\"float\\\"}, \\\"driving_safety_score\\\": {\\\"type\\\": \\\"float\\\"}, \\\"driving_score\\\": {\\\"type\\\": \\\"float\\\"}, \\\"duration\\\": {\\\"type\\\": \\\"long\\\"}, \\\"duration_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_battery\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"end_battery_level\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_odometer\\\": {\\\"type\\\": \\\"double\\\"}, \\\"end_position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_soc\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"end_voltage\\\": {\\\"type\\\": \\\"float\\\"}, \\\"engine_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"excessive_idle_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"excessive_over_speed_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"final_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_acceleration\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_acceleration_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_braking\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_braking_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_cornering\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_turn_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"idle_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"ignition_records\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"indexed_at\\\": {\\\"type\\\": \\\"date\\\"}, \\\"max_speed\\\": {\\\"type\\\": \\\"float\\\"}, \\\"max_speed_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"more_events_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"motion_records\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"motion_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"night_driving\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_ignition\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_motion\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_speed\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_speed_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"over_speed_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"penalty_list\\\": {\\\"type\\\": \\\"nested\\\", \\\"properties\\\": {\\\"count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"type\\\": {\\\"type\\\": \\\"keyword\\\"}, \\\"weight\\\": {\\\"type\\\": \\\"integer\\\"}}}, \\\"penalty_per_km\\\": {\\\"type\\\": \\\"float\\\"}, \\\"power_difference\\\": {\\\"type\\\": \\\"float\\\"}, \\\"power_end\\\": {\\\"type\\\": \\\"float\\\"}, \\\"power_start\\\": {\\\"type\\\": \\\"float\\\"}, \\\"server_id\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"start_battery\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"start_battery_level\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_odometer\\\": {\\\"type\\\": \\\"double\\\"}, \\\"start_position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"start_soc\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"start_voltage\\\": {\\\"type\\\": \\\"float\\\"}, \\\"timestamp\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"timestamp_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"timestamp_time\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 64}, \\\"trip_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"utilization\\\": {\\\"type\\\": \\\"float\\\"}}}}]\\n\\n[[ ## es_schema_available ## ]]\\nTrue\\n\\n[[ ## vector_index_available ## ]]\\nTrue\\n\\nRespond with the corresponding output fields, starting with the field `[[ ## workflow_plan ## ]]` (must be formatted as a valid Python list[str]), then `[[ ## is_within_context ## ]]` (must be formatted as a valid Python bool), and then ending with the marker for `[[ ## completed ## ]]`.\"}]"}}, {"trace_id": "V8pFp9sAaCiVP+Cyg1HCCA==", "span_id": "EK7ruBZuBpQ=", "parent_span_id": "Suxosnx26Cg=", "name": "LM.__call__", "start_time_unix_nano": 1768286764083728005, "end_time_unix_nano": 1768286765308440163, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-57ca45a7db006828953fe0b28351c208\"", "mlflow.spanType": "\"CHAT_MODEL\"", "mlflow.spanInputs": "{\"messages\": [{\"role\": \"system\", \"content\": \"Your input fields are:\\n1. `system_prompt` (str): System prompt to guide workflow planning decisions based on user query and context, also defines the responsibilities of the workflow planner\\n2. `detailed_user_query` (list[str]): List of detailed analysis from ThinkingSignature containing user intent, context understanding, and indicators of analytics/reports questions, information retrieval requests, or references to previous data/charts. Each item represents a specific aspect of the user's query.\\n3. `es_schema` (list[dict[str, Any]]): Complete Elasticsearch schema definition showing available indices, field mappings, and data types. Analyze to determine if relevant structured data exists for the user's analytical needs\\n4. `es_schema_available` (bool): Boolean indicating whether the Elasticsearch schema is available for querying. True if schema exists, False if not\\n5. `vector_index_available` (bool): Boolean indicating whether the vector index is available for querying\\nYour output fields are:\\n1. `workflow_plan` (list[str]): Ordered execution sequence using: 'EsQueryProcessor' (structured data queries), 'VectorQueryProcessor' (semantic document search for information retrieval), 'SummarySignature' (ALWAYS required for text analysis), 'ChartGenerator' (for visualizations). CRITICAL: Always include data processor when ChartGenerator needed, user references previous data, OR for information retrieval requests (legal, procedural, guidelines, how-to)\\n2. `is_within_context` (bool): Boolean indicating whether the user query is within the scope and context of the system prompt. True if the query relates to the agent's defined responsibilities and capabilities, False if the query is outside the agent's domain or asking for unrelated functionality\\nAll interactions will be structured in the following way, with the appropriate values filled in.\\n\\n[[ ## system_prompt ## ]]\\n{system_prompt}\\n\\n[[ ## detailed_user_query ## ]]\\n{detailed_user_query}\\n\\n[[ ## es_schema ## ]]\\n{es_schema}\\n\\n[[ ## es_schema_available ## ]]\\n{es_schema_available}\\n\\n[[ ## vector_index_available ## ]]\\n{vector_index_available}\\n\\n[[ ## workflow_plan ## ]]\\n{workflow_plan}        # note: the value you produce must adhere to the JSON schema: {\\\"type\\\": \\\"array\\\", \\\"items\\\": {\\\"type\\\": \\\"string\\\"}}\\n\\n[[ ## is_within_context ## ]]\\n{is_within_context}        # note: the value you produce must be True or False\\n\\n[[ ## completed ## ]]\\nIn adhering to this structure, your objective is: \\n        Decides workflow based on conversation context, query type, and data availability\\n        , whether es_schema and vector_index are available or not needs to be considered.\\n        \\n        Decision Logic:\\n        1. Check detailed_user_query for previous ES/Vector queries → maintain consistency\\n        2. Analyze detailed_user_query for analytics/reports/analysis questions → prefer ES if schema allows and es_schema_available\\n        3. Check for information retrieval requests (legal, procedural, guidelines, how-to) → use Vector search if vector_index_available\\n        4. Check es_schema relevance for new structured data queries → use ES if relevant\\n        5. If no relevant data sources available, return is_within_context as False and system will return error\\n        6. ALWAYS include a data query processor (ES or Vector) when ChartGenerator is needed\\n        7. ALWAYS include a data query processor for follow-up questions that reference previous data\\n        8. ALWAYS include a data query processor for information retrieval requests\\n        \\n        Always include SummarySignature. Include ChartGenerator based on user intent.\"}, {\"role\": \"user\", \"content\": \"[[ ## system_prompt ## ]]\\nYou are an intelligent assistant for Bolt SaaS clients. Your role is to assist with support and reporting-related queries only. For support questions, refer to the 'bolt_support_doc' vector database, which contains knowledge base articles and help documentation. For reporting and analytics questions, use the provided Elasticsearch schemas related to vehicle and sensor data to generate accurate insights, summaries, and visualizations. Never respond to queries outside the support or reporting scope.\\n\\n[[ ## detailed_user_query ## ]]\\n[\\\"Summarize electric vehicle registrations by state for the latest quarter available in the dataset.\\\"]\\n\\n[[ ## es_schema ## ]]\\n[{\\\"index\\\": \\\"summary_reports\\\", \\\"mappings\\\": {\\\"properties\\\": {\\\"avg_speed\\\": {\\\"type\\\": \\\"float\\\"}, \\\"crash\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"device_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"device_name\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"distance\\\": {\\\"type\\\": \\\"float\\\"}, \\\"driver_name\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"driving_safety_score\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"driving_score\\\": {\\\"type\\\": \\\"long\\\"}, \\\"duration\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"end_time_date\\\": {\\\"type\\\": \\\"date\\\"}, \\\"end_time_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_time_time\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"engine_2_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"engine_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"excessive_idle_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"excessive_over_speed_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"final_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"first_ignition_on\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"first_position_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"fuel_consumption\\\": {\\\"type\\\": \\\"float\\\"}, \\\"geo_in_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"geo_in_distance\\\": {\\\"type\\\": \\\"float\\\"}, \\\"geo_in_end\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"geo_in_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"geo_out_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"geo_out_distance\\\": {\\\"type\\\": \\\"float\\\"}, \\\"geo_out_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"harsh_acceleration\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_acceleration_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_braking\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_braking_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_cornering\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_turn_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"idle_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"ign_off_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"ign_on_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"ignition_records\\\": {\\\"type\\\": \\\"long\\\"}, \\\"indexed_at\\\": {\\\"type\\\": \\\"date\\\"}, \\\"last_battery\\\": {\\\"type\\\": \\\"float\\\"}, \\\"last_battery_level\\\": {\\\"type\\\": \\\"float\\\"}, \\\"last_ignition_on\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"last_position_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"max_speed\\\": {\\\"type\\\": \\\"float\\\"}, \\\"max_speed_time\\\": {\\\"type\\\": \\\"date\\\"}, \\\"max_speed_time_date\\\": {\\\"type\\\": \\\"date\\\"}, \\\"max_speed_time_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"max_speed_time_time\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"more_events_penalty\\\": {\\\"type\\\": \\\"long\\\"}, \\\"motion_records\\\": {\\\"type\\\": \\\"long\\\"}, \\\"motion_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"night_driving\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_ignition\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_motion\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_speed\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_speed_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"over_speed_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"penalty_per_km\\\": {\\\"type\\\": \\\"float\\\"}, \\\"power_cut_counts\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"raw_positions_count\\\": {\\\"type\\\": \\\"long\\\"}, \\\"region\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"server_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"start_battery\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_battery_level\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"start_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"start_time_date\\\": {\\\"type\\\": \\\"date\\\"}, \\\"start_time_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"start_time_time\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"stop_report_count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"stop_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"summary_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"timestamp_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"timestamp_time\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 64}, \\\"utilization\\\": {\\\"type\\\": \\\"float\\\"}, \\\"vehicle_type\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}}}}, {\\\"index\\\": \\\"stop_idle_reports\\\", \\\"mappings\\\": {\\\"properties\\\": {\\\"device_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"device_name\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"duration_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"engine_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"indexed_at\\\": {\\\"type\\\": \\\"date\\\"}, \\\"lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"server_id\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"start_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"stop_idle_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"timestamp_column1\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"timestamp_column2\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"timestamp_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"timestamp_time\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 64}, \\\"type\\\": {\\\"type\\\": \\\"keyword\\\"}}}}, {\\\"index\\\": \\\"trip_reports\\\", \\\"mappings\\\": {\\\"properties\\\": {\\\"avg_speed\\\": {\\\"type\\\": \\\"float\\\"}, \\\"crash\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"device_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"device_name\\\": {\\\"type\\\": \\\"text\\\", \\\"fields\\\": {\\\"keyword\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 256}}}, \\\"distance\\\": {\\\"type\\\": \\\"float\\\"}, \\\"driving_safety_score\\\": {\\\"type\\\": \\\"float\\\"}, \\\"driving_score\\\": {\\\"type\\\": \\\"float\\\"}, \\\"duration\\\": {\\\"type\\\": \\\"long\\\"}, \\\"duration_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_battery\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"end_battery_level\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_odometer\\\": {\\\"type\\\": \\\"double\\\"}, \\\"end_position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"end_soc\\\": {\\\"type\\\": \\\"float\\\"}, \\\"end_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"end_voltage\\\": {\\\"type\\\": \\\"float\\\"}, \\\"engine_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"excessive_idle_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"excessive_over_speed_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"final_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_acceleration\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_acceleration_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_braking\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_braking_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"harsh_cornering\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"harsh_turn_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"idle_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"ignition_records\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"indexed_at\\\": {\\\"type\\\": \\\"date\\\"}, \\\"max_speed\\\": {\\\"type\\\": \\\"float\\\"}, \\\"max_speed_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"more_events_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"motion_records\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"motion_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"night_driving\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_ignition\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_motion\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_speed\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"over_speed_penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"over_speed_seconds\\\": {\\\"type\\\": \\\"long\\\"}, \\\"penalty_list\\\": {\\\"type\\\": \\\"nested\\\", \\\"properties\\\": {\\\"count\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"penalty\\\": {\\\"type\\\": \\\"float\\\"}, \\\"type\\\": {\\\"type\\\": \\\"keyword\\\"}, \\\"weight\\\": {\\\"type\\\": \\\"integer\\\"}}}, \\\"penalty_per_km\\\": {\\\"type\\\": \\\"float\\\"}, \\\"power_difference\\\": {\\\"type\\\": \\\"float\\\"}, \\\"power_end\\\": {\\\"type\\\": \\\"float\\\"}, \\\"power_start\\\": {\\\"type\\\": \\\"float\\\"}, \\\"server_id\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"start_battery\\\": {\\\"type\\\": \\\"integer\\\"}, \\\"start_battery_level\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_lat\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_lng\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_odometer\\\": {\\\"type\\\": \\\"double\\\"}, \\\"start_position_id\\\": {\\\"type\\\": \\\"long\\\"}, \\\"start_soc\\\": {\\\"type\\\": \\\"float\\\"}, \\\"start_time\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd HH:mm:ss.SSS Z||yyyy-MM-dd HH:mm:ss.SSS||strict_date_optional_time||epoch_millis\\\"}, \\\"start_voltage\\\": {\\\"type\\\": \\\"float\\\"}, \\\"timestamp\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd'T'HH:mm:ss||yyyy-MM-dd HH:mm:ss||epoch_millis\\\"}, \\\"timestamp_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"timestamp_epoch\\\": {\\\"type\\\": \\\"long\\\"}, \\\"timestamp_time\\\": {\\\"type\\\": \\\"keyword\\\", \\\"ignore_above\\\": 64}, \\\"trip_date\\\": {\\\"type\\\": \\\"date\\\", \\\"format\\\": \\\"yyyy-MM-dd\\\"}, \\\"utilization\\\": {\\\"type\\\": \\\"float\\\"}}}}]\\n\\n[[ ## es_schema_available ## ]]\\nTrue\\n\\n[[ ## vector_index_available ## ]]\\nTrue\\n\\nRespond with the corresponding output fields, starting with the field `[[ ## workflow_plan ## ]]` (must be formatted as a valid Python list[str]), then `[[ ## is_within_context ## ]]` (must be formatted as a valid Python bool), and then ending with the marker for `[[ ## completed ## ]]`.\"}], \"prompt\": null, \"temperature\": 0.0, \"frequency_penalty\": 0.0}", "temperature": "0.0", "max_tokens": "4000", "model": "\"openai/gpt-4.1-mini\"", "model_type": "\"chat\"", "cache": "true", "mlflow.message.format": "\"dspy\"", "mlflow.spanOutputs": "[\"[[ ## workflow_plan ## ]]\\n[\\\"EsQueryProcessor\\\", \\\"SummarySignature\\\"]\\n\\n[[ ## is_within_context ## ]]\\nTrue\\n\\n[[ ## completed ## ]]\"]"}}, {"trace_id": "V8pFp9sAaCiVP+Cyg1HCCA==", "span_id": "SltHteRcjF0=", "parent_span_id": "Suxosnx26Cg=", "name": "ChatAdapter.parse", "start_time_unix_nano": 1768286765309445762, "end_time_unix_nano": 1768286765310383766, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-57ca45a7db006828953fe0b28351c208\"", "mlflow.spanType": "\"PARSER\"", "mlflow.spanInputs": "{\"signature\": \"QueryWorkflowPlanner(system_prompt, detailed_user_query, es_schema, es_schema_available, vector_index_available -> workflow_plan, is_within_context\\n    instructions='Decides workflow based on conversation context, query type, and data availability\\\\n, whether es_schema and vector_index are available or not needs to be considered.\\\\n\\\\nDecision Logic:\\\\n1. Check detailed_user_query for previous ES/Vector queries → maintain consistency\\\\n2. Analyze detailed_user_query for analytics/reports/analysis questions → prefer ES if schema allows and es_schema_available\\\\n3. Check for information retrieval requests (legal, procedural, guidelines, how-to) → use Vector search if vector_index_available\\\\n4. Check es_schema relevance for new structured data queries → use ES if relevant\\\\n5. If no relevant data sources available, return is_within_context as False and system will return error\\\\n6. ALWAYS include a data query processor (ES or Vector) when ChartGenerator is needed\\\\n7. ALWAYS include a data query processor for follow-up questions that reference previous data\\\\n8. ALWAYS include a data query processor for information retrieval requests\\\\n\\\\nAlways include SummarySignature. Include ChartGenerator based on user intent.'\\n    system_prompt = Field(annotation=str required=True json_schema_extra={'desc': 'System prompt to guide workflow planning decisions based on user query and context, also defines the responsibilities of the workflow planner', '__dspy_field_type': 'input', 'prefix': 'System Prompt:'})\\n    detailed_user_query = Field(annotation=List[str] required=True json_schema_extra={'desc': \\\"List of detailed analysis from ThinkingSignature containing user intent, context understanding, and indicators of analytics/reports questions, information retrieval requests, or references to previous data/charts. Each item represents a specific aspect of the user's query.\\\", '__dspy_field_type': 'input', 'prefix': 'Detailed User Query:'})\\n    es_schema = Field(annotation=List[Dict[str, Any]] required=True json_schema_extra={'desc': \\\"Complete Elasticsearch schema definition showing available indices, field mappings, and data types. Analyze to determine if relevant structured data exists for the user's analytical needs\\\", '__dspy_field_type': 'input', 'prefix': 'Es Schema:'})\\n    es_schema_available = Field(annotation=bool required=True json_schema_extra={'desc': 'Boolean indicating whether the Elasticsearch schema is available for querying. True if schema exists, False if not', '__dspy_field_type': 'input', 'prefix': 'Es Schema Available:'})\\n    vector_index_available = Field(annotation=bool required=True json_schema_extra={'desc': 'Boolean indicating whether the vector index is available for querying', '__dspy_field_type': 'input', 'prefix': 'Vector Index Available:'})\\n    workflow_plan = Field(annotation=List[str] required=True json_schema_extra={'desc': \\\"Ordered execution sequence using: 'EsQueryProcessor' (structured data queries), 'VectorQueryProcessor' (semantic document search for information retrieval), 'SummarySignature' (ALWAYS required for text analysis), 'ChartGenerator' (for visualizations). CRITICAL: Always include data processor when ChartGenerator needed, user references previous data, OR for information retrieval requests (legal, procedural, guidelines, how-to)\\\", '__dspy_field_type': 'output', 'prefix': 'Workflow Plan:'})\\n    is_within_context = Field(annotation=bool required=True json_schema_extra={'desc': \\\"Boolean indicating whether the user query is within the scope and context of the system prompt. True if the query relates to the agent's defined responsibilities and capabilities, False if the query is outside the agent's domain or asking for unrelated functionality\\\", '__dspy_field_type': 'output', 'prefix': 'Is Within Context:'})\\n)\", \"completion\": \"[[ ## workflow_plan ## ]]\\n[\\\"EsQueryProcessor\\\", \\\"SummarySignature\\\"]\\n\\n[[ ## is_within_context ## ]]\\nTrue\\n\\n[[ ## completed ## ]]\"}", "mlflow.spanOutputs": "{\"workflow_plan\": [\"EsQueryProcessor\", \"SummarySignature\"], \"is_within_context\": true}"}}]}